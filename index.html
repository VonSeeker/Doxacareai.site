<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DoxaCare AI - Healthcare Assistant for Sierra Leone</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f0fdf4;
    }
        
    .typing-indicator::after {
      content: '...';
      animation: typing 1.5s infinite;
    }
        
    @keyframes typing {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
    }
        
    .translate-btn {
      transition: all 0.3s ease;
    }
        
    .translate-btn:hover {
      transform: scale(1.05);
    }
        
    .emergency-shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
        
    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    /* Custom styles for the modal overlay */
    .modal-overlay {
        background-color: rgba(0, 0, 0, 0.5);
    }
    /* Custom styles for scrollbar in comments section */
    .max-h-48::-webkit-scrollbar {
        width: 8px;
    }
    .max-h-48::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    .max-h-48::-webkit-scrollbar-thumb {
        background: #cbd5e1; /* gray-300 */
        border-radius: 10px;
    }
    .max-h-48::-webkit-scrollbar-thumb:hover {
        background: #94a3b8; /* gray-400 */
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <div id="auth-root"></div>
  <div id="app-content">
  <!-- Header -->
  <header class="bg-gradient-to-r from-green-600 to-yellow-400 shadow-md">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <i class="fas fa-heartbeat text-white text-2xl"></i>
        <h1 class="text-white font-bold text-xl md:text-2xl">DoxaCare AI</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button id="languageToggle" class="bg-white text-green-800 px-3 py-1 rounded-full text-sm font-medium flex items-center translate-btn">
          <span id="currentLanguage">Krio</span>
          <i class="fas fa-exchange-alt ml-1"></i>
        </button>
        <button id="emergencyBtn" class="bg-red-600 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center hover:bg-red-700 emergency-shake">
          <i class="fas fa-exclamation-triangle mr-1"></i>
          Emergency
        </button>
      </div>
    </div>
  </header>
  <!-- Nav Tabs -->
  <div class="bg-white shadow-sm">
    <div class="container mx-auto px-4">
      <div class="flex overflow-x-auto">
        <button class="tab-btn active px-4 py-3 text-green-700 font-medium border-b-2 border-green-700 whitespace-nowrap" data-tab="home">
          <i class="fas fa-home mr-2"></i>Home
        </button>
        <button class="tab-btn px-4 py-3 text-gray-600 font-medium whitespace-nowrap" data-tab="symptoms">
          <i class="fas fa-notes-medical mr-2"></i>Health Topics
        </button>
        <button class="tab-btn px-4 py-3 text-gray-600 font-medium whitespace-nowrap" data-tab="advice">
          <i class="fas fa-lightbulb mr-2"></i>Health Advice
        </button>
        <button class="tab-btn px-4 py-3 text-gray-600 font-medium whitespace-nowrap" data-tab="clinics">
          <i class="fas fa-hospital mr-2"></i>Find Clinics
        </button>
          </div>
    </div>
  </div>
  <!-- Main Content -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <!-- Home Tab (default visible) -->
    <div id="home-tab" class="tab-content active">
      <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
        <div class="bg-green-100 p-4 border-b border-green-200">
          <h2 class="text-green-800 font-bold text-lg">Welcome to DoxaCare AI</h2>
          <p id="welcomeText" class="text-gray-700 text-sm mt-1">Your trusted healthcare assistant for Sierra Leone. Ask about symptoms, get health advice, or find nearby clinics.</p>
          <p id="welcomeTextKrio" class="text-gray-700 text-sm mt-1 hidden">EvaCare AI wey dey for you pan Salone health. Ask about sick wey you get, take health advice, or find clinic close to you.</p>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
              <h3 class="font-bold text-yellow-800 mb-2 flex items-center">
                <i class="fas fa-bell text-yellow-600 mr-2"></i>
                <span id="healthAlertsTitle">Health Alerts</span>
              </h3>
              <div class="text-sm text-gray-700">
                <div id="healthAlertsText">
                  <p>• Monkeypox outbreak spreading nationwide (May 2025)</p>
                  <p>• Avoid contact with wild animals</p>
                  <p>• Isolate if rash/fever develops</p>
                </div>
                <div id="healthAlertsTextKrio" class="hidden">
                  <p>• Monkeypox dey spread for all Salone (May 2025)</p>
                  <p>• No touch bush meat or wild animal</p>
                  <p>• Stay for house if you get rash or fever</p>
                </div>
              </div>
            </div>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <h3 class="font-bold text-blue-800 mb-2 flex items-center">
                <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>
                <span id="quickLinksTitle">Quick Chats</span>
              </h3>
              <div class="grid grid-cols-2 gap-2">
                <button class="quick-action-btn bg-green-100 text-green-800" data-action="malaria">
                  <i class="fas fa-bug mr-1"></i>
                  <span id="malariaBtnText">Malaria</span>
                </button>
                <button class="quick-action-btn bg-yellow-100 text-yellow-800" data-action="pregnancy">
                  <i class="fas fa-baby mr-1"></i>
                  <span id="pregnancyBtnText">Pregnancy</span>
                </button>
                <button class="quick-action-btn bg-red-100 text-red-800" data-action="diarrhea">
                  <i class="fas fa-tint mr-1"></i>
                  <span id="diarrheaBtnText">Diarrhea</span>
                </button>
                <button class="quick-action-btn bg-purple-100 text-purple-800" data-action="hypertension">
                  <i class="fas fa-heartbeat mr-1"></i>
                  <span id="hypertensionBtnText">Hypertension</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
            <!-- Chat Interface -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="bg-green-600 p-3">
          <h2 class="text-white font-bold flex items-center">
            <i class="fas fa-comments mr-2"></i>
            <span id="chatTitle">Chat with DoxaCare AI</span>
          </h2>
        </div>
        <div id="chatWindow" class="h-64 overflow-y-auto p-4 bg-gray-50">
          <div class="chat-message bot-message mb-3">
            <div class="bg-white p-3 rounded-lg shadow-sm max-w-3/4 inline-block">
              <p id="welcomeChatText">Hello! How can I assist you with your health today? You can describe symptoms, ask for advice, or find clinics near you.</p>
              <p id="welcomeChatTextKrio" class="hidden">How you dey? Wetin I fit do for you health today? You fit talk about sick wey you get, ask for advice, or find clinic close to you.</p>
              <div class="quick-reply-buttons mt-2 flex flex-wrap gap-2">
                <button class="quick-reply-btn bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full">I have fever</button>
                <button class="quick-reply-btn bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full">Mosquito bite advice</button>
                <button class="quick-reply-btn bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full">Find clinic near me</button>
              </div>
            </div>
          </div>
        </div>
        <div class="p-3 bg-gray-100 border-t border-gray-200">
          <div class="flex items-center">
            <input type="text" id="userInput" placeholder="Type your health question here..." class="flex-grow px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
            <button id="sendBtn" class="ml-2 bg-green-600 text-white p-2 rounded-full hover:bg-green-700 transition-colors">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
            <!-- Cultural Feature Section -->
      <div class="mt-6 bg-white rounded-lg shadow-md overflow-hidden">
        <div class="bg-gradient-to-r from-yellow-400 to-green-600 p-3">
          <h2 class="text-white font-bold flex items-center">
            <i class="fas fa-globe-africa mr-2"></i>
            <span id="culturalTitle">Cultural Health Tips</span>
          </h2>
        </div>
        <div class="p-4">
          <div class="flex flex-col md:flex-row items-center">
            <img src="https://images.app.goo.gl/yodxUkY2sWEmGoMB9" alt="Lumley Beach in Freetown, Sierra Leone" class="w-32 h-32 md:w-48 md:h-48 object-cover rounded-lg shadow mb-4 md:mb-0 md:mr-4">
            <div>
              <h3 class="font-semibold text-green-800 mb-2" id="localTipTitle">Local Health Wisdom</h3>
              <div id="culturalTipText" class="text-gray-700">
                <p>• Boil water for drinking to prevent waterborne diseases.</p>
                <p>• Use insecticide-treated nets (ITNs) every night during rainy season.</p>
                <p>• Sun-dry clothes thoroughly to kill germs.</p>
              </div>
              <div id="culturalTipTextKrio" class="text-gray-700 hidden">
                <p>• Make water hot well-well before you drink am to stop water sickness.</p>
                <p>• Use net wey get medicine for kill mosquito every night when rain dey fall.</p>
                <p>• Make sun dry your clothes proper to kill all germ.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
        
    <!-- Symptom Checker Tab -->
    <div id="symptoms-tab" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="bg-blue-600 p-3 flex justify-between items-center">
          <h2 class="text-white font-bold flex items-center">
            <i class="fas fa-notes-medical mr-2"></i>
            <span>Health Topics</span>
          </h2>
          <button id="refreshHealthTopics" class="text-white hover:text-blue-200 transition-colors" title="Refresh health topics">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
        <div class="p-4">
          <div id="symptomInputArea" class="mb-4">
            <label for="symptomsInput" class="block text-gray-700 mb-2">Ask about any health topic:</label>
            <div class="flex">
              <input type="text" id="symptomsInput" class="flex-grow px-4 py-2 rounded-l-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g. fever, exercise tips, nutrition advice">
              <button id="checkSymptomsBtn" class="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700">Ask</button>
            </div>
          </div>
          <div id="symptomResults" class="hidden border-t pt-4">
            <h3 class="font-semibold text-gray-800 mb-3">Possible Conditions:</h3>
            <!-- Results will be inserted here by JavaScript -->
          </div>
          <div class="mt-4 p-3 bg-gray-100 rounded-lg">
            <h4 class="font-medium text-gray-700 mb-2">Common Health Topics:</h4>
            <div class="grid grid-cols-2 gap-2">
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="fever,chills,headache,muscle pain">Malaria</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="fever,abdominal pain,constipation,diarrhea">Typhoid</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="watery diarrhea,vomiting,dehydration">Cholera</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="high fever,severe headache,eye pain,muscle pain">Dengue</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="cough,fever,difficulty breathing">Pneumonia</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="fever,headache,stiff neck,sensitivity to light">Meningitis</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="fever,skin rash,conjunctivitis,muscle pain">Lassa Fever</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm" data-symptoms="fever,cough,loss of taste/smell,difficulty breathing">COVID-19</button>
            </div>
          </div>
          <div class="mt-4 p-3 bg-gray-100 rounded-lg">
            <h4 class="font-medium text-gray-700 mb-2">Common Symptoms:</h4>
            <div class="flex flex-wrap gap-2">
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded-full text-sm">Fever</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded-full text-sm">Exercise</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded-full text-sm">Nutrition</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded-full text-sm">Pregnancy</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded-full text-sm">Diabetes</button>
              <button class="symptom-tag bg-white border border-blue-200 text-blue-700 px-3 py-1 rounded-full text-sm">Mental Health</button>
            </div>
          </div>
        </div>
      </div>
    </div>
        
    <!-- Health Advice Forum Tab -->
    <div id="advice-tab" class="tab-content hidden">
      <div class="max-w-3xl w-full bg-white rounded-lg shadow-md overflow-hidden">
          <div class="bg-purple-600 p-3 flex justify-between items-center rounded-t-lg">
              <h2 class="text-white font-bold flex items-center text-xl">
                  <i class="fas fa-comments mr-2"></i>
                  Community Health Forum
              </h2>
              <button id="newPostBtn"
                  class="bg-white text-purple-600 px-3 py-1 rounded-full text-sm font-medium hover:bg-purple-100 transition-colors shadow-sm">
                  <i class="fas fa-plus mr-1"></i> New Post
              </button>
          </div>

          <div id="postsContainer" class="p-4 space-y-4">
              <!-- Posts will be dynamically inserted here by JavaScript -->
              <div id="noPostsMessage" class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center text-gray-600">
                  <i class="fas fa-exclamation-circle text-gray-400 text-3xl mb-3"></i>
                  <p class="font-medium text-lg mb-2">No posts yet!</p>
                  <p class="mb-4">Be the first to share a health question or advice with the community.</p>
                  <button id="startNewDiscussionBtn"
                      class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-lg transition-colors shadow-md">
                      Start a New Discussion
                  </button>
              </div>
          </div>

          <!-- New Post Modal -->
          <div id="newPostModal" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4 hidden">
              <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6 transform transition-all duration-300 scale-95 opacity-0" id="newPostModalContent">
                  <div class="flex justify-between items-center mb-4">
                      <h3 class="text-xl font-bold text-purple-700">Create New Post</h3>
                      <button id="closeNewPostModalBtn" class="text-gray-500 hover:text-gray-700">
                          <i class="fas fa-times text-lg"></i>
                      </button>
                  </div>
                  <div class="mb-4">
                      <label for="postTitle" class="block text-gray-700 text-sm font-medium mb-2">
                          Title:
                      </label>
                      <input type="text" id="postTitle"
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                          placeholder="Enter post title">
                  </div>
                  <div class="mb-6">
                      <label for="postContent" class="block text-gray-700 text-sm font-medium mb-2">
                          Content:
                      </label>
                      <textarea id="postContent" rows="5"
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-y"
                          placeholder="Share your health question or advice..."></textarea>
                  </div>
                  <div class="flex justify-end space-x-3">
                      <button id="cancelPostBtn"
                          class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors shadow-sm">
                          Cancel
                      </button>
                      <button id="submitPostBtn"
                          class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors shadow-md">
                          Submit Post
                      </button>
                  </div>
              </div>
          </div>

          <!-- Custom Alert Modal -->
          <div id="customAlertModal" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4 hidden">
              <div class="bg-white rounded-lg shadow-xl max-w-sm w-full p-6 transform transition-all duration-300 scale-95 opacity-0" id="customAlertModalContent">
                  <div class="flex justify-between items-center mb-4">
                      <h3 class="text-xl font-bold text-red-700" id="alertTitle">Alert</h3>
                      <button id="closeAlertModalBtn" class="text-gray-500 hover:text-gray-700">
                          <i class="fas fa-times text-lg"></i>
                      </button>
                  </div>
                  <p id="alertMessage" class="text-gray-700 mb-6"></p>
                  <div class="flex justify-end">
                      <button id="okAlertBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors shadow-md">
                          OK
                      </button>
                  </div>
              </div>
          </div>
      </div>
    </div>
        
    <!-- Find Clinics Tab -->
    <div id="clinics-tab" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="bg-red-600 p-3">
          <h2 class="text-white font-bold flex items-center">
            <i class="fas fa-hospital mr-2"></i>
            <span>Find Clinics</span>
          </h2>
        </div>
        <div class="p-4">
          <div class="mb-4">
            <label for="locationInput" class="block text-gray-700 mb-2">Enter your location (district or city):</label>
            <div class="flex">
              <input type="text" id="locationInput" class="flex-grow px-4 py-2 rounded-l-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent" placeholder="e.g. Freetown, Bo, Kenema">
              <button id="findClinicsBtn" class="bg-red-600 text-white px-4 py-2 rounded-r-lg hover:bg-red-700">Search</button>
            </div>
          </div>
          <div id="clinicResults" class="space-y-4">
            <!-- Sample clinic cards - will be replaced by dynamic content -->
            <div class="border border-gray-200 rounded-lg p-3">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="font-semibold text-gray-800">Connaught Hospital</h3>
                  <p class="text-sm text-gray-600">Freetown • Government Hospital</p>
                </div>
                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">24-Hour</span>
              </div>
              <div class="mt-2 flex items-center text-sm">
                <i class="fas fa-phone-alt text-blue-500 mr-2"></i>
                <span>+232 25 345678</span>
              </div>
              <div class="mt-1 flex items-center text-sm">
                <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
                <span>Lightfoot Boston St, Freetown</span>
              </div>
            </div>
            <div class="border border-gray-200 rounded-lg p-3">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="font-semibold text-gray-800">Bo Government Hospital</h3>
                  <p class="text-sm text-gray-600">Bo • Government Hospital</p>
                </div>
              </div>
              <div class="mt-2 flex items-center text-sm">
                <i class="fas fa-phone-alt text-blue-500 mr-2"></i>
                <span>+232 76 345678</span>
              </div>
              <div class="mt-1 flex items-center text-sm">
                <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
                <span>Kissi Town, Bo</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
        </main>
  <!-- Footer -->
  <footer class="bg-green-800 text-white py-6">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <h3 class="font-bold mb-3">EvaCare AI</h3>
          <p class="text-sm">Providing trusted healthcare advice for Sierra Leone</p>
          <div class="mt-3">
            <p class="text-sm"><i class="fas fa-phone-alt mr-2"></i> Emergency: 117, 112</p>
          </div>
        </div>
        <div>
          <h3 class="font-bold mb-3">Important Links</h3>
          <ul class="space-y-2 text-sm">
            <li><a href="https://www.who.int/countries/sle" target="_blank" class="hover:underline">WHO Sierra Leone</a></li>
            <li><a href="https://mohs.gov.sl" target="_blank" class="hover:underline">Sierra Leone Ministry of Health</a></li>
            <li><a href="https://www.nmcp.gov.sl" target="_blank" class="hover:underline">National Malaria Control Program</a></li>
            <li><a href="https://www.unicef.org/sierraleone/health" target="_blank" class="hover:underline">UNICEF Child Health</a></li>
          </ul>
        </div>
        <div>
          <h3 class="font-bold mb-3">Disclaimer</h3>
          <p class="text-xs">EvaCare AI provides general health information only and does not replace professional medical advice. Always consult a qualified healthcare provider for diagnosis and treatment.</p>
        </div>
      </div>
      <div class="border-t border-green-700 mt-6 pt-4 text-center text-sm">
        <p>© 2023 EvaCare AI - Healthcare Assistant for Sierra Leone</p>
      </div>
    </div>
  </footer>
  <!-- Emergency Modal -->
  <div id="emergencyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-red-600">
          <i class="fas fa-exclamation-triangle mr-2"></i>
          Emergency Assistance
        </h3>
        <button id="closeEmergencyModal" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <p class="text-gray-700 mb-4">If you're experiencing a medical emergency, please take these immediate actions:</p>
      <ul class="space-y-2 mb-4">
        <li class="flex items-start">
          <i class="fas fa-phone-alt text-red-500 mt-1 mr-2"></i>
          <span>Call emergency services: <strong>117 or 112</strong></span>
        </li>
        <li class="flex items-start">
          <i class="fas fa-hospital text-red-500 mt-1 mr-2"></i>
          <span>Go to the nearest hospital immediately</span>
        </li>
        <li class="flex items-start">
          <i class="fas fa-user-md text-red-500 mt-1 mr-2"></i>
          <span>Alert someone nearby for assistance</span>
        </li>
      </ul>
      <div class="bg-red-50 border border-red-200 rounded p-3 mb-4">
        <p class="text-sm text-red-700">Call 117 or go to the closest medical facility immediately if you experience:</p>
        <ul class="list-disc list-inside text-sm text-red-700 mt-1 pl-2">
          <li>Difficulty breathing</li>
          <li>Chest pain</li>
          <li>Severe bleeding</li>
          <li>Loss of consciousness</li>
        </ul>
      </div>
      <button id="callEmergencyBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg">
        <i class="fas fa-phone mr-2"></i> Call Emergency Services Now
      </button>
    </div>
  </div>
  <script>
    // Force refresh by adding cache-busting parameter
    if (performance.navigation.type === 1) {
      window.location.search = '?refresh=' + new Date().getTime();
    }
        // Language Toggle
    const languageToggle = document.getElementById('languageToggle');
    const currentLanguage = document.getElementById('currentLanguage');
    const welcomeText = document.getElementById('welcomeText');
    const welcomeTextKrio = document.getElementById('welcomeTextKrio');
    const welcomeChatText = document.getElementById('welcomeChatText');
    const welcomeChatTextKrio = document.getElementById('welcomeChatTextKrio');
    const healthAlertsText = document.getElementById('healthAlertsText');
    const healthAlertsTextKrio = document.getElementById('healthAlertsTextKrio');
    const culturalTipText = document.getElementById('culturalTipText');
    const culturalTipTextKrio = document.getElementById('culturalTipTextKrio');
    const malariaBtnText = document.getElementById('malariaBtnText');
    const pregnancyBtnText = document.getElementById('pregnancyBtnText');
    const diarrheaBtnText = document.getElementById('diarrheaBtnText');
    const hypertensionBtnText = document.getElementById('hypertensionBtnText');
    const chatTitle = document.getElementById('chatTitle');
    const welcomeTitle = document.getElementById('welcomeTitle');
    const culturalTitle = document.getElementById('culturalTitle');
    const localTipTitle = document.getElementById('localTipTitle');
    const healthAlertsTitle = document.getElementById('healthAlertsTitle');
    const quickLinksTitle = document.getElementById('quickLinksTitle');
        let isEnglish = false;
        languageToggle.addEventListener('click', () => {
      isEnglish = !isEnglish;
            if (isEnglish) {
        currentLanguage.textContent = 'English';
        welcomeText.classList.remove('hidden');
        welcomeTextKrio.classList.add('hidden');
        healthAlertsText.classList.remove('hidden');
        healthAlertsTextKrio.classList.add('hidden');
        welcomeChatText.classList.remove('hidden');
        welcomeChatTextKrio.classList.add('hidden');
        culturalTipText.classList.remove('hidden');
        culturalTipTextKrio.classList.add('hidden');
        malariaBtnText.textContent = 'Malaria';
        pregnancyBtnText.textContent = 'Pregnancy';
        diarrheaBtnText.textContent = 'Diarrhea';
        hypertensionBtnText.textContent = 'Hypertension';
        chatTitle.textContent = 'Chat with EvaCare AI';
        culturalTitle.textContent = 'Cultural Health Tips';
        localTipTitle.textContent = 'Local Health Wisdom';
        healthAlertsTitle.textContent = 'Health Alerts';
        quickLinksTitle.textContent = 'Quick Chats';
      } else {
        currentLanguage.textContent = 'Krio';
        welcomeText.classList.add('hidden');
        welcomeTextKrio.classList.remove('hidden');
        healthAlertsText.classList.add('hidden');
        healthAlertsTextKrio.classList.remove('hidden');
        welcomeChatText.classList.add('hidden');
        welcomeChatTextKrio.classList.remove('hidden');
        culturalTipText.classList.add('hidden');
        culturalTipTextKrio.classList.remove('hidden');
        malariaBtnText.textContent = 'Malaria';
        pregnancyBtnText.textContent = 'Belleful';
        diarrheaBtnText.textContent = 'Run belle';
        hypertensionBtnText.textContent = 'High BP';
        chatTitle.textContent = 'Chat wit EvaCare AI';
        culturalTitle.textContent = 'Health Tip for We Culture';
        localTipTitle.textContent = 'Local Health Sense';
        healthAlertsTitle.textContent = 'Health News';
        quickLinksTitle.textContent = 'Quick Chat';
      }
    });
        // Tab Switching
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');
                // Update active state for buttons
        tabButtons.forEach(btn => btn.classList.remove('active', 'text-green-700', 'border-green-700'));
        button.classList.add('active', 'text-green-700', 'border-green-700');
                // Update active state for tab contents
        tabContents.forEach(content => {
          content.classList.add('hidden');
          content.classList.remove('active');
        });
                document.getElementById(`${tabId}-tab`).classList.remove('hidden');
        document.getElementById(`${tabId}-tab`).classList.add('active');
      });
    });
        // Quick Action Buttons
    const quickActionBtns = document.querySelectorAll('.quick-action-btn');
        quickActionBtns.forEach(button => {
      button.addEventListener('click', () => {
        const action = button.getAttribute('data-action');
        const chatWindow = document.getElementById('chatWindow');
                switch(action) {
          case 'malaria':
            addUserMessage('malaria prevention');
            simulateBotResponse('Malaria prevention is crucial in Sierra Leone. Use insecticide-treated mosquito nets every night, wear protective clothing in the evening, and eliminate stagnant water around your home where mosquitoes breed. If you experience fever, headache, or chills, seek medical attention immediately as these could be malaria symptoms.');
            break;
          case 'pregnancy':
            addUserMessage('pregnancy care');
            simulateBotResponse('For healthy pregnancy: Attend all antenatal check-ups, take prescribed iron and folic acid supplements, eat nutritious meals, and learn about danger signs like severe headaches, blurred vision,');
            break;
          case 'diarrhea':
            addUserMessage('diarrhea treatment');
            simulateBotResponse('For diarrhea, the most important thing is to prevent dehydration. Drink plenty of fluids, especially Oral Rehydration Salts (ORS). Avoid sugary drinks. If diarrhea is severe, bloody, or accompanied by high fever, seek medical attention.');
            break;
          case 'hypertension':
            addUserMessage('hypertension management');
            simulateBotResponse('Hypertension (high blood pressure) can be managed with a healthy diet low in salt, regular exercise, maintaining a healthy weight, and avoiding smoking and excessive alcohol. Regular check-ups and medication as prescribed by a doctor are essential.');
            break;
          default:
            simulateBotResponse("I'm not sure about that specific quick action, but I can help with general health questions!");
        }
      });
    });
    // Chatbot functionality (simplified)
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatWindow = document.getElementById('chatWindow');
    function addUserMessage(message) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('chat-message', 'user-message', 'mb-3', 'text-right');
      messageDiv.innerHTML = `<div class="bg-green-500 p-3 rounded-lg shadow-sm max-w-3/4 inline-block text-white">${message}</div>`;
      chatWindow.appendChild(messageDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight; // Scroll to bottom
    }
    function simulateBotResponse(userMessage) {
      const lowerMessage = userMessage.toLowerCase();
      let response = "I'm still learning! Can you please rephrase or ask a different question?";
      if (lowerMessage.includes("fever") || lowerMessage.includes("sick")) {
        response = "If you have a fever, it's important to rest, drink plenty of fluids, and consider paracetamol. If it's severe or persists, please see a doctor.";
      } else if (lowerMessage.includes("malaria")) {
        response = "Malaria symptoms include fever, chills, headache, and muscle pain. Seek immediate medical attention for diagnosis and treatment. Use mosquito nets and repellent for prevention.";
      } else if (lowerMessage.includes("pregnancy")) {
        response = "For pregnancy-related questions, it's best to consult with a healthcare professional for personalized advice and prenatal care.";
      } else if (lowerMessage.includes("clinic") || lowerMessage.includes("hospital")) {
        response = "To find a clinic, please navigate to the 'Find Clinics' tab and enter your location.";
      } else if (lowerMessage.includes("mosquito")) {
        response = "To prevent mosquito bites, use insecticide-treated nets, apply repellent, and eliminate stagnant water sources around your home.";
      } else if (lowerMessage.includes("hello") || lowerMessage.includes("hi")) {
        response = "Hello there! How can I help you today?";
      }
      const typingIndicator = document.createElement('div');
      typingIndicator.classList.add('chat-message', 'bot-message', 'mb-3', 'typing-indicator');
      typingIndicator.innerHTML = '<div class="bg-white p-3 rounded-lg shadow-sm max-w-3/4 inline-block italic text-gray-500">DoxaCare AI is typing</div>';
      chatWindow.appendChild(typingIndicator);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      setTimeout(() => {
        chatWindow.removeChild(typingIndicator);
        const botMessageDiv = document.createElement('div');
        botMessageDiv.classList.add('chat-message', 'bot-message', 'mb-3');
        botMessageDiv.innerHTML = `<div class="bg-white p-3 rounded-lg shadow-sm max-w-3/4 inline-block">${response}</div>`;
        chatWindow.appendChild(botMessageDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }, 1500); // Simulate typing delay
    }
    sendBtn?.addEventListener('click', () => {
      const message = userInput.value.trim();
      if (message) {
        addUserMessage(message);
        simulateBotResponse(message);
        userInput.value = '';
      }
    });
    userInput?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendBtn?.click();
      }
    });
    document.querySelectorAll('.quick-reply-btn').forEach(button => {
      button.addEventListener('click', (event) => {
        const text = event.target.textContent || '';
        if (text) {
          addUserMessage(text);
          simulateBotResponse(text);
        }
      });
    });
    // Symptom checker functionality (simplified)
    const symptomsInput = document.getElementById('symptomsInput');
    const checkSymptomsBtn = document.getElementById('checkSymptomsBtn');
    const symptomResults = document.getElementById('symptomResults');
    const refreshHealthTopics = document.getElementById('refreshHealthTopics');
    function simulateHealthTopicResponse(topic) {
      let resultHTML = '';
      const lowerTopic = topic.toLowerCase();
      if (lowerTopic.includes("fever") || lowerTopic.includes("malaria")) {
        resultHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-2">
            <h4 class="font-semibold text-blue-800">Malaria (High Probability)</h4>
            <p class="text-sm text-gray-700">Symptoms: Fever, chills, headache, muscle aches, fatigue. Can be severe if untreated.</p>
            <p class="text-xs text-gray-600 mt-1">Recommended Action: Seek immediate medical attention for diagnosis and treatment. Use mosquito nets.</p>
          </div>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <h4 class="font-semibold text-blue-800">Typhoid Fever (Possible)</h4>
            <p class="text-sm text-gray-700">Symptoms: Sustained fever, weakness, stomach pain, headache, loss of appetite. Spreads through contaminated food/water.</p>
            <p class="text-xs text-gray-600 mt-1">Recommended Action: Consult a doctor for tests and antibiotics. Practice good hygiene.</p>
          </div>
        `;
      } else if (lowerTopic.includes("exercise")) {
        resultHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <h4 class="font-semibold text-blue-800">Benefits of Regular Exercise</h4>
            <p class="text-sm text-gray-700">Regular physical activity improves heart health, strengthens muscles and bones, boosts mood, and helps manage weight.</p>
            <p class="text-xs text-gray-600 mt-1">Recommended Action: Aim for at least 30 minutes of moderate exercise most days of the week. Start slowly if you're new.</p>
          </div>
        `;
      } else if (lowerTopic.includes("nutrition")) {
        resultHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <h4 class="font-semibold text-blue-800">Healthy Eating Tips</h4>
            <p class="text-sm text-gray-700">Focus on a balanced diet with plenty of fruits, vegetables, whole grains, and lean proteins. Limit processed foods, sugar, and unhealthy fats.</p>
            <p class="text-xs text-gray-600 mt-1">Recommended Action: Incorporate local, seasonal foods. Drink plenty of clean water.</p>
          </div>
        `;
      } else if (lowerTopic.includes("diabetes")) {
        resultHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <h4 class="font-semibold text-blue-800">Understanding Diabetes</h4>
            <p class="text-sm text-gray-700">Diabetes is a chronic condition that affects how your body turns food into energy. It can lead to serious health problems if not managed.</p>
            <p class="text-xs text-gray-600 mt-1">Recommended Action: Regular check-ups, healthy diet, exercise, and medication as prescribed. Consult a doctor for diagnosis and management.</p>
          </div>
        `;
      } else {
        resultHTML = `<p class="text-gray-600 italic">No specific information found for "${topic}". Please try a more general health topic or symptom.</p>`;
      }
      if (symptomResults) {
        symptomResults.innerHTML = resultHTML;
        symptomResults.classList.remove('hidden');
      }
    }
    checkSymptomsBtn?.addEventListener('click', () => {
      const inputTopic = symptomsInput.value.trim();
      if (inputTopic) {
        simulateHealthTopicResponse(inputTopic);
      } else {
        showAlert("Please enter a health topic or symptom.");
      }
    });
    symptomsInput?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkSymptomsBtn?.click();
      }
    });
    document.querySelectorAll('.symptom-tag').forEach(button => {
      button.addEventListener('click', (event) => {
        const tagText = event.target.textContent || '';
        const dataSymptoms = event.target.dataset.symptoms || tagText;
        symptomsInput.value = dataSymptoms; // Prefill input with the tag value
        checkSymptomsBtn?.click(); // Trigger search
      });
    });
    refreshHealthTopics?.addEventListener('click', () => {
      symptomsInput.value = '';
      if (symptomResults) {
        symptomResults.innerHTML = '';
        symptomResults.classList.add('hidden');
      }
    });
    // Find Clinics functionality (simplified)
    const locationInput = document.getElementById('locationInput');
    const findClinicsBtn = document.getElementById('findClinicsBtn');
    const clinicResults = document.getElementById('clinicResults');
    function simulateClinicSearch(location) {
      let resultsHTML = '';
      const lowerLocation = location.toLowerCase();
      if (lowerLocation.includes("freetown")) {
        resultsHTML = `
          <div class="border border-gray-200 rounded-lg p-3 shadow-sm">
            <h4 class="font-semibold text-red-700">Central Freetown Hospital</h4>
            <p class="text-sm text-gray-700">Address: Hospital Rd, Freetown</p>
            <p class="text-xs text-gray-600 mt-1">Services: General medicine, emergency, surgery. Open 24/7.</p>
            <a href="#" class="text-red-500 hover:underline text-sm mt-2 block">View on Map</a>
          </div>
          <div class="border border-gray-200 rounded-lg p-3 shadow-sm">
            <h4 class="font-semibold text-red-700">Lumley Community Clinic</h4>
            <p class="text-sm text-gray-700">Address: Lumley Beach Rd, Freetown</p>
            <p class="text-xs text-gray-600 mt-1">Services: Outpatient care, maternal & child health. Mon-Fri, 8 AM - 5 PM.</p>
            <a href="#" class="text-red-500 hover:underline text-sm mt-2 block">View on Map</a>
          </div>
        `;
      } else if (lowerLocation.includes("bo")) {
        resultsHTML = `
          <div class="border border-gray-200 rounded-lg p-3 shadow-sm">
            <h4 class="font-semibold text-red-700">Bo Government Hospital</h4>
            <p class="text-sm text-gray-700">Address: Hospital Road, Bo</p>
            <p class="text-xs text-gray-600 mt-1">Services: General hospital services. Open 24/7.</p>
            <a href="#" class="text-red-500 hover:underline text-sm mt-2 block">View on Map</a>
          </div>
        `;
      } else if (lowerLocation.includes("kenema")) {
        resultsHTML = `
          <div class="border border-gray-200 rounded-lg p-3 shadow-sm">
            <h4 class="font-semibold text-red-700">Kenema Government Hospital</h4>
            <p class="text-sm text-gray-700">Address: Clinic Road, Kenema</p>
            <p class="text-xs text-gray-600 mt-1">Services: Major regional hospital. Open 24/7.</p>
            <a href="#" class="text-red-500 hover:underline text-sm mt-2 block">View on Map</a>
          </div>
        `;
      } else {
        resultsHTML = `<p class="text-gray-600 italic">No clinics found for "${location}". Try "Freetown", "Bo", or "Kenema".</p>`;
      }
      if (clinicResults) {
        clinicResults.innerHTML = resultsHTML;
      }
    }
    findClinicsBtn?.addEventListener('click', () => {
      const location = locationInput.value.trim();
      if (location) {
        simulateClinicSearch(location);
      } else {
        showAlert("Please enter a location to search for clinics.");
      }
    });
    locationInput?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        findClinicsBtn?.click();
      }
    });
    // START Community Forum JS
    // Global state variables
    let posts = [];
    // DOM elements
    // Note: These elements are within the #advice-tab, so ensure they are correctly scoped if other tabs use similar IDs.
    // For this combined file, we'll assume unique IDs across the entire document.
    const postsContainer = document.getElementById('postsContainer');
    const noPostsMessage = document.getElementById('noPostsMessage');
    const newPostBtn = document.getElementById('newPostBtn');
    const startNewDiscussionBtn = document.getElementById('startNewDiscussionBtn');
    const newPostModal = document.getElementById('newPostModal');
    const newPostModalContent = document.getElementById('newPostModalContent');
    const closeNewPostModalBtn = document.getElementById('closeNewPostModalBtn');
    const postTitleInput = document.getElementById('postTitle');
    const postContentTextarea = document.getElementById('postContent');
    const cancelPostBtn = document.getElementById('cancelPostBtn');
    const submitPostBtn = document.getElementById('submitPostBtn');
    const customAlertModal = document.getElementById('customAlertModal');
    const customAlertModalContent = document.getElementById('customAlertModalContent');
    const alertTitle = document.getElementById('alertTitle');
    const alertMessage = document.getElementById('alertMessage');
    const closeAlertModalBtn = document.getElementById('closeAlertModalBtn');
    const okAlertBtn = document.getElementById('okAlertBtn');
    // Helper function for custom alert
    function showAlert(message, title = 'Alert') {
        alertTitle.textContent = title;
        alertMessage.textContent = message;
        customAlertModal.classList.remove('hidden');
        setTimeout(() => {
            customAlertModalContent.classList.remove('opacity-0', 'scale-95');
            customAlertModalContent.classList.add('opacity-100', 'scale-100');
        }, 10); // Small delay for transition
    }
    function hideAlert() {
        customAlertModalContent.classList.remove('opacity-100', 'scale-100');
        customAlertModalContent.classList.add('opacity-0', 'scale-95');
        setTimeout(() => {
            customAlertModal.classList.add('hidden');
        }, 300); // Match transition duration
    }
    // Event listeners for custom alert
    closeAlertModalBtn.addEventListener('click', hideAlert);
    okAlertBtn.addEventListener('click', hideAlert);
    // Helper function to generate unique IDs
    function generateUniqueId() {
        return Math.random().toString(36).substring(2, 9) + Date.now().toString(36);
    }
    // Helper function to format timestamp
    function formatTimestamp(date) {
        const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true,
        };
        return new Intl.DateTimeFormat('en-US', options).format(date);
    }
    // Function to render a single post
    function renderPost(post) {
        const postDiv = document.createElement('div');
        postDiv.id = `post-${post.id}`; // Add an ID for easy lookup
        postDiv.className = 'border border-gray-200 rounded-lg p-4 bg-gray-50 shadow-sm';
        postDiv.innerHTML = `
            <h4 class="font-semibold text-purple-700 text-lg mb-2">${post.title}</h4>
            <p class="text-gray-700 text-base mb-3">${post.content}</p>
            <div class="flex items-center text-xs text-gray-500 mb-4">
                <div class="bg-gray-200 border-2 border-dashed rounded-full w-6 h-6 mr-2 flex items-center justify-center overflow-hidden">
                    <i class="fas fa-user text-gray-400 text-sm"></i>
                </div>
                <span>By ${post.author}</span>
                <span class="mx-2">•</span>
                <span>${post.timestamp}</span>
            </div>
            <!-- Comments Section -->
            <div class="mt-4 border-t border-gray-200 pt-4">
                <h5 class="font-medium text-gray-800 mb-3 flex items-center">
                    <i class="fas fa-comment-dots mr-2 text-blue-500"></i>
                    Comments (<span id="commentCount-${post.id}">${post.comments.length}</span>)
                </h5>
                <div id="commentsList-${post.id}" class="space-y-3 mb-4 max-h-48 overflow-y-auto pr-2">
                    <!-- Comments will be dynamically inserted here -->
                </div>
                <p id="noCommentsMessage-${post.id}" class="text-sm text-gray-600 italic mb-3 ${post.comments.length > 0 ? 'hidden' : ''}">No comments yet. Be the first to reply!</p>
                <!-- Add Comment Input -->
                <div class="flex items-center mt-2">
                    <input type="text" id="commentInput-${post.id}"
                        class="flex-grow px-3 py-2 rounded-l-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"
                        placeholder="Add a comment..." data-post-id="${post.id}">
                    <button class="add-comment-btn bg-purple-500 text-white p-2 rounded-r-lg hover:bg-purple-600 transition-colors shadow-sm" data-post-id="${post.id}">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        `;
        // Render existing comments for the post
        const commentsList = postDiv.querySelector(`#commentsList-${post.id}`);
        post.comments.forEach(comment => {
            commentsList.appendChild(renderComment(comment));
        });
        return postDiv;
    }
    // Function to render a single comment
    function renderComment(comment) {
        const commentDiv = document.createElement('div');
        commentDiv.id = `comment-${comment.id}`;
        commentDiv.className = 'bg-white border border-gray-100 rounded-lg p-3 shadow-xs';
        commentDiv.innerHTML = `
            <p class="text-gray-700 text-sm mb-1">${comment.text}</p>
            <div class="flex items-center text-xs text-gray-500">
                <div class="bg-gray-200 border-2 border-dashed rounded-full w-5 h-5 mr-1 flex items-center justify-center overflow-hidden">
                    <i class="fas fa-reply text-gray-400 text-xs"></i>
                </div>
                <span>By ${comment.author}</span>
                <span class="mx-1">•</span>
                <span>${comment.timestamp}</span>
            </div>
        `;
        return commentDiv;
    }
    // Function to update the entire posts display
    function updatePostsDisplay() {
        postsContainer.innerHTML = ''; // Clear existing posts
        if (posts.length === 0) {
            noPostsMessage.classList.remove('hidden');
            postsContainer.appendChild(noPostsMessage);
        } else {
            noPostsMessage.classList.add('hidden');
            // Add posts in reverse order to show newest at top
            posts.slice().reverse().forEach(post => {
                postsContainer.appendChild(renderPost(post));
            });
        }
        addCommentEventListeners(); // Re-attach listeners after re-rendering
    }
    // Function to show the new post modal
    function showNewPostModal() {
        newPostModal.classList.remove('hidden');
        setTimeout(() => {
            newPostModalContent.classList.remove('opacity-0', 'scale-95');
            newPostModalContent.classList.add('opacity-100', 'scale-100');
        }, 10); // Small delay for transition
        postTitleInput.value = '';
        postContentTextarea.value = '';
        postTitleInput.focus();
    }
    // Function to hide the new post modal
    function hideNewPostModal() {
        newPostModalContent.classList.remove('opacity-100', 'scale-100');
        newPostModalContent.classList.add('opacity-0', 'scale-95');
        setTimeout(() => {
            newPostModal.classList.add('hidden');
        }, 300); // Match transition duration
    }
    // Event handler for adding a new post
    function handleAddPost() {
        const title = postTitleInput.value.trim();
        const content = postContentTextarea.value.trim();
        if (title === '' || content === '') {
            showAlert('Please fill in both title and content for your post.');
            return;
        }
        const newPost = {
            id: generateUniqueId(),
            title: title,
            content: content,
            author: 'Anonymous User', // Default author
            timestamp: formatTimestamp(new Date()),
            comments: [],
        };
        posts.push(newPost); // Add new post to the array
        updatePostsDisplay(); // Re-render all posts
        hideNewPostModal();
    }
    // Event handler for adding a comment
    function handleAddComment(postId, commentText) {
        if (commentText === '') {
            showAlert('Please enter your comment.');
            return;
        }
        const newComment = {
            id: generateUniqueId(),
            author: 'Community Member', // Default author
            text: commentText,
            timestamp: formatTimestamp(new Date()),
        };
        const postIndex = posts.findIndex(p => p.id === postId);
        if (postIndex !== -1) {
            posts[postIndex].comments.push(newComment);
            // Update the specific post's comments section without re-rendering everything
            const commentsListElement = document.getElementById(`commentsList-${postId}`);
            const noCommentsMessageElement = document.getElementById(`noCommentsMessage-${postId}`);
            const commentCountElement = document.getElementById(`commentCount-${postId}`);
            if (commentsListElement) {
                commentsListElement.appendChild(renderComment(newComment));
                commentsListElement.scrollTop = commentsListElement.scrollHeight; // Scroll to bottom
            }
            if (noCommentsMessageElement) {
                noCommentsMessageElement.classList.add('hidden');
            }
            if (commentCountElement) {
                commentCountElement.textContent = posts[postIndex].comments.length;
            }
        }
        // Clear the specific comment input after adding
        const commentInput = document.getElementById(`commentInput-${postId}`);
        if (commentInput) {
            commentInput.value = '';
        }
    }
    // Function to add event listeners to all comment buttons and inputs
    function addCommentEventListeners() {
        document.querySelectorAll('.add-comment-btn').forEach(button => {
            // Remove existing listener to prevent duplicates
            button.removeEventListener('click', handleCommentButtonClick);
            button.addEventListener('click', handleCommentButtonClick);
        });
        document.querySelectorAll('input[id^="commentInput-"]').forEach(input => {
            // Remove existing listener to prevent duplicates
            input.removeEventListener('keypress', handleCommentInputKeyPress);
            input.addEventListener('keypress', handleCommentInputKeyPress);
        });
    }
    // Event handler for comment button click
    function handleCommentButtonClick(event) {
        const postId = event.currentTarget.dataset.postId;
        const commentInput = document.getElementById(`commentInput-${postId}`);
        if (commentInput) {
            handleAddComment(postId, commentInput.value);
        }
    }
    // Event handler for comment input keypress (Enter key)
    function handleCommentInputKeyPress(event) {
        if (event.key === 'Enter') {
            const postId = event.currentTarget.dataset.postId;
            const commentInput = event.currentTarget;
            handleAddComment(postId, commentInput.value);
        }
    }
    // Initial setup and event listeners for Community Forum
    // This will run when the main DoxaCare AI DOMContentLoaded fires
    document.addEventListener('DOMContentLoaded', () => { // Corrected: ensure this wraps all main JS
        updatePostsDisplay(); // Render initial state (no posts)
        newPostBtn.addEventListener('click', showNewPostModal);
        startNewDiscussionBtn.addEventListener('click', showNewPostModal); // Button inside "no posts" message
        closeNewPostModalBtn.addEventListener('click', hideNewPostModal);
        cancelPostBtn.addEventListener('click', hideNewPostModal);
        submitPostBtn.addEventListener('click', handleAddPost);
        // Close modal if clicking outside the content
        newPostModal.addEventListener('click', (event) => {
            if (event.target === newPostModal) {
                hideNewPostModal();
            }
        });
        customAlertModal.addEventListener('click', (event) => {
            if (event.target === customAlertModal) {
                hideAlert();
            }
        });
    });
    // END Community Forum JS
  </script>
</body>
</html>

